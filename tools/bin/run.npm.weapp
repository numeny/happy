#!/bin/bash

# use $HAPPY_CLIENT_PATH of .bashrc

export NPM_PORT_CONF=node_modules/@tarojs/webpack-runner/dist/config/devServer.conf.js

function rand(){
    min=$1
    max=$(($2-$min+1))
    num=$(date +%s%N)
    echo $(($num%$max+$min))
}
 
rnd=$(rand 1 100)
#echo $rnd
rnd1=$(expr 10000 + $rnd)
#echo $rnd1
echo $rnd1 > /tmp/curr_port
sed -i "s/port: .*/port: ${rnd1},/g" $HAPPY_CLIENT_PATH/$NPM_PORT_CONF
cd $HAPPY_CLIENT_PATH
npm run dev:weapp&
